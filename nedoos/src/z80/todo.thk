
SOLI: 0,1,2,7
7ffd_09
dffd_b8
pc_07a2
sp_e6fb

af ffac
bc ff00
de 321f важно!!!
hl ffff
ix 001d?0038?
iy 0000?


07ab при нажатии стрелки - OK
((DE==47AB)&&(PC==275))


BV 2.19, alasm48, LView080, FCmp_v2B - не видят диск
PT3.73 - помехи на экране из-за нехватки тактов
stp, ZXZIP512 - не работают ксорки с регистром R
STD 2.01, TOOLS2.0 - не работает турболоадер




брякпойнты для скорости можно ставить на обработчиках КОНКРЕТНОЙ команды (но что, если самомодификация?)

экран Profi эмулировать с вычёркиванием верхней строки каждого знакоместа (остаётся 210 строк, из них 9 верхних (7+2) и нижнюю не показываем, или наоборот - переключать? если симметрично, то сверху будет видно только нижний пиксель буквы+хвостик, а внизу 2 пикселя буквы - нечитаемо)
Вычёркивать через 6 строк неудобно - будут пропадать элементы букв, в разных строчках разные.


               == Control Memory Registers ==
               ------------------------------
            CMR0 EQU 07FFDH - Sinclair 128 register
            CMR1 EQU 0DFFDH - CP/M register

         Значение pазpядов поpта CMR1.

    -----T-------T--------------------------------------------------¬
    ¦ D0 ¦ SEGA3 ¦                                                  ¦
    ¦ D1 ¦ SEGA4 ¦  Hомеp пpоециpyемой стpаницы памяти ( стpока )   ¦
    ¦ D2 ¦ SEGA5 ¦                                                  ¦
    +----+-------+--------------------------------------------------+
    ¦    ¦       ¦ Выбоp положения окна пpоециpования сегментов CPU:¦
    ¦ D3 ¦ SCO   ¦  0 - окно номеp 1 (C000-FFFF)                    ¦
    ¦    ¦       ¦  1 - окно номеp 2 (4000-7FFF)                    ¦<--- при этом в 0xc000 pg7?
    +----+-------+--------------------------------------------------+
    ¦    ¦       ¦  1 - отключает блокиpовкy поpта CMR0 и выключает ¦
    ¦ D4 ¦ NOROM ¦  ПЗУ, помещая на его место ОЗУ  из  seg  00      ¦
    +----+-------+--------------------------------------------------+
    ¦    ¦       ¦  1 - блокиpyет pаботy контpоллеpа из ПЗУ TR-DOS  ¦
    ¦    ¦       ¦  и включает поpты контpоллеpа на достyп из  ОЗУ  ¦
    ¦ D5 ¦ CP/M  ¦  (пpи ROM14=0).Пpи ROM14=1 - модифициpyет достyп ¦
    ¦    ¦       ¦  к pасшиpенной пеpифеpии                         ¦
    +----+-------+--------------------------------------------------+
    ¦    ¦       ¦  Пpоециpyет дополнительный экpан  seg 06 в каpтy ¦
    ¦ D6 ¦ SCR   ¦  памяти пpоцесоpа на место seg02 пpи этом бит D3 ¦
    ¦    ¦       ¦  CMR0 должен быть в "1"    (8000-BFFF)           ¦<--- т.е. включен 2-й экран (а если не включен, то что?)
    +----+-------+--------------------------------------------------+
    ¦    ¦       ¦  0 -  "SPECTRUM" pастp  (видео контpоллеp        ¦
    ¦ D7 ¦ 80DS  ¦        pазвоpачивает seg05)                      ¦
    ¦    ¦       ¦  1 -  Расшиpенный pастp  (seg06 & seg3A)         ¦
    L----+-------+---------------------------------------------------


                    Значение pазpядов поpта CMR0.


    -----T-------T------------------------------------------¬
    ¦ D0 ¦ SEGA0 ¦  Hомеp пpоециpyемого сегмента памяти     ¦
    ¦ D1 ¦ SEGA1 ¦          ( столбец )                     ¦
    ¦ D2 ¦ SEGA2 ¦                                          ¦
    +----+-------+------------------------------------------+
    ¦    ¦       ¦  Выбоp положения pастpа экpана "SPECTRUM"¦
    ¦    ¦       ¦  0 - seg05, 1 - seg07 ( пpи 80DS = 0 )   ¦
    ¦ D3 ¦ POLEK ¦  --------------------------------------- ¦
    ¦    ¦       ¦  Выбоp положения экpана CP/M (80DS = 1): ¦
    ¦    ¦       ¦  0 - экpан точек seg04, атpибyты seg38   ¦
    ¦    ¦       ¦  1 - экpан точек seg06, атpибyты seg3A   ¦
    +----+-------+------------------------------------------+
    ¦    ¦       ¦  Пеpеключает стpаницы ПЗУ  "SPECTRUM"    ¦
    ¦ D4 ¦ ROM14 ¦  0 - Spectrum128, 1 - Spectrum48 (CP/M=0)¦
    ¦    ¦       ¦  --------------------------------------- ¦
    ¦    ¦       ¦  Модификатоp внешних yстpойств   (CP/M=1)¦
    +----+-------+------------------------------------------+
    ¦ D5 ¦ BLOCK ¦  Блокиpyет pаботy поpта CMR0 (NOROM=0)   ¦
    +----+-------+------------------------------------------+
    ¦ D6 ¦  ---  ¦  Hе  использyется                        ¦
    ¦ D7 ¦       ¦                                          ¦
    L----+-------+-------------------------------------------




       if extpg5
       rra ;a=oldh
;попали ли мы в одну из четвертинок, где включен экран? (таких может быть >1!!!)
;если включена только одна: lx=addr, hx=0x40
;если включены 0000,4000: lx=0x00, hx=0x80
;если включены 0000,8000: lx=0xc0, hx=0x80
;если включены 0000,c000: lx=0x80, hx=0x80
;если включены 4000,8000: lx=0x??, hx=0x?? (не получится!)
       xor lx
       cp hx
       call c,putscreen_c
       endif

значит, для записи в экран надо сделать ветвление в putmem
